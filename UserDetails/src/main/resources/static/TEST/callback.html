<!DOCTYPE html>
<html lang="US_en">

<head>
    <meta charset="UTF-8">
    <title>SSD Automation</title>
    <script type="text/javascript" src="bower_components/jquery/dist/jquery.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="text/javascript" src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
    <script type="text/javascript" src="bower_components/angular/angular.min.js"></script>
    <script type="text/javascript" src="bower_components/angular-route/angular-route.min.js"></script>
    <!-- custom css file -->
    <link rel="stylesheet" type="text/css" href="styles.css">
    <!-- ng-table -->
    <script type="text/javascript" src="lib/ng-table/ng-table.min.js"></script>
    <link rel="stylesheet" type="text/css" href="lib/ng-table/ng-table.min.css">
</head>

<body ng-app="myApp1" ng-controller="myCtrl1">

<div class="container">
	<div>We have reached callback.html!</div>
</div>
    
</body>

<script>

	var app =  angular.module('myApp1', []);
	
	app.controller('myCtrl1', function($scope, $http){
	
	
		 var req = {
            method: 'GET',
            url: 'http://localhost:8080/details'
        }
		
		
		global_token = "test";
		

        $http(req).then(function(response) {
		
              
			
				return response.data.value;
			
                
            },
            function(error) {
                alert(error.data.message);
            }).then(function(token){ //token has response value i.e. access token
			
				
				var req_followed = {
            method: 'GET',
            url: 'https://api.spotify.com/v1/me/following?type=artist',
			headers: {
				"Authorization": "Bearer "+token
			}
        }
		
		var req_Distance = {
            		method: 'GET',
            		url: "https://maps.googleapis.com/maps/api/distancematrix/json?origins=" + str_from + "&destinations=" + str_to + "&mode=driving&language=fr-FR&avoid=tolls&key=YOUR_API_KEY";
            		headers:{
            			
            		}
            }
		 $http(req_followed).then(function(response) {
               return response;
				
                
            },
            function(error) {
                console.log(error);
            }).then(sendData);;
			
			
			})
		
		
	
	function sendData(response)
	{
		names = [];

			artists = response.data.artists.items;
			
			for (var i = 0; i < artists.length; i++) {
				names.push(artists[i].name);
		
				}
		
				if (navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(showPosition);
				} else {
					x.innerHTML = "Geolocation is not supported by this browser.";
				}
				
				
				function showPosition(position) {
				latitude = position.coords.latitude
				longitude = position.coords.longitude; 
				
					$http.post("http://localhost:8080/lat/"+latitude+"/lon/"+longitude, JSON.stringify(names)).then(function(response){
						final String str_from = latitude "+" longitude; 
                
                console.log(response);
            },
            function(error) {
                alert(error.data.message);
            });
					
		
		}
	}	
		
	});
	   
	var Gmaps =  angular.module('GmapApp', []);
	
	app.controller('GmapCtrl', function($Gscope, $Ghttp){
		
		global_token = "Gtest";
		

        $Ghttp(Greq).then(function(Gresponse) {
		
              
			
				return Gresponse.data.value;
			
                
            },
            function(error) {
                alert(error.data.message);
            }).then(function(token){ //token has response value i.e. access token
			
		
		var req_Distance = {
            		method: 'GET',
            		url: "https://maps.googleapis.com/maps/api/distancematrix/json?origins=" + str_from + "&destinations=" + str_to + "&mode=driving&language=fr-FR&avoid=tolls&key=YOUR_API_KEY";
            		headers:{
            			
            		}
            }
            
            function(error) {
                console.log(error);
            }).then(sendData);;
			
            @Override
    	    protected String doInBackground(String... params) {
    	        try {
    	            URL url=new URL(params[0]);
    	            HttpURLConnection con= (HttpURLConnection) url.openConnection();
    	            con.setRequestMethod("GET");
    	            con.connect();
    	            int statuscode=con.getResponseCode();
    	            if(statuscode==HttpURLConnection.HTTP_OK)
    	            {
    	                BufferedReader br=new BufferedReader(new InputStreamReader(con.getInputStream()));
    	                StringBuilder sb=new StringBuilder();
    	                String line=br.readLine();
    	                while(line!=null)
    	                {
    	                    sb.append(line);
    	                    line=br.readLine();
    	                }
    	                String json=sb.toString();
    	                Log.d("JSON",json);
    	                JSONObject root=new JSONObject(json);
    	                JSONArray array_rows=root.getJSONArray("rows");
    	                Log.d("JSON","array_rows:"+array_rows);
    	                JSONObject object_rows=array_rows.getJSONObject(0);
    	                Log.d("JSON","object_rows:"+object_rows);
    	                JSONArray array_elements=object_rows.getJSONArray("elements");
    	                Log.d("JSON","array_elements:"+array_elements);
    	                JSONObject  object_elements=array_elements.getJSONObject(0);
    	                Log.d("JSON","object_elements:"+object_elements);
    	                JSONObject object_duration=object_elements.getJSONObject("duration");
    	                JSONObject object_distance=object_elements.getJSONObject("distance");

    	                Log.d("JSON","object_duration:"+object_duration);
    	                return object_duration.getString("value")+","+object_distance.getString("value");

    	            }
			})
		}
	}	
		
	});
	}
	
	
</script>